{% extends "blogs/base.html" %}

{% block title %}
  {{ ficha_tecnica.nome }} | Blog do Projeto | Luiz R. Dererita
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/blogs/style.css') }}">
<style>
  /* === Popup de Compartilhamento === */
  body.blog-popup #share-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.65);
    backdrop-filter: blur(2px);
    z-index: 998;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  body.blog-popup #share-overlay.active {
    opacity: 1;
  }

  body.blog-popup #share-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1c1c1c;
    color: white;
    padding: 1.5rem 2rem;
    border-radius: 12px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.4);
    z-index: 999;
    width: 300px;
    max-width: 90%;
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  body.blog-popup #share-popup.active {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  body.blog-popup .share-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 1rem;
  }

  body.blog-popup .share-buttons a,
  body.blog-popup .share-buttons button {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
  }

  body.blog-popup .btn-close-popup {
    position: absolute;
    top: 10px;
    right: 12px;
    background: none;
    border: none;
    font-size: 1.25rem;
    color: white;
    cursor: pointer;
  }

  body.blog-popup .hidden-popup {
    display: none !important;
  }
</style>
{% endblock %}

{% block content %}
<!-- Seção de Postagens -->
<h2 class="section-title mt-4" id="postagens">Novidades</h2>

{% for post in posts %}
  <div class="card bg-dark text-white mb-4">
    <div class="card-body position-relative">

      <!-- Ícone de Compartilhamento -->
      <a href="#" class="share-icon-top" title="Compartilhar este post">
        <i class="fas fa-share-nodes"></i>
      </a>

      <h5 class="card-title">{{ post.titulo }}</h5>
      <p class="meta-info post-data">
        Postado em <strong>{{ post.data|data_extensa }}</strong> por <strong>{{ post.autor }}</strong>
      </p>

      <div class="preview-separator"></div>

      {% if post.imagem %}
        <img src="{{ url_for('static', filename=post.imagem) }}"
             alt="Preview de {{ post.titulo }}"
             class="preview-img-fluid">
      {% endif %}

      <p class="card-text mt-3">
        {{ post.conteudo|striptags|truncate(500, True, '...') }}
      </p>

      <a href="{{ url_for('ver_post', projeto=projeto, nome=post.nome_arquivo) }}"
         class="btn btn-outline-light btn-sm">
        Ler mais
      </a>

    <div class="preview-separator"></div>

    <div class="post-meta d-flex justify-content-start align-items-center gap-4 mt-2">
      <!-- Visualizações -->
      <span><i class="far fa-eye"></i> {{ post.visualizacoes or 0 }}</span>
      <!-- Comentários -->
      <span><i class="far fa-comment"></i> <span id="contador-{{ post.nome_arquivo }}">0</span></span>
      <!-- Disqus contador invisível para pegar os dados -->
      <a href="{{ url_for('ver_post', projeto=projeto, nome=post.nome_arquivo) }}#disqus_thread"
        class="disqus-comment-count d-none"
        data-disqus-identifier="{{ projeto }}/{{ post.nome_arquivo }}">
        0
      </a>
    </div>

    </div>
  </div>
{% endfor %}

<!-- Paginação -->
{% if total_paginas > 1 %}
  <nav>
    <ul class="pagination justify-content-center">
      <!-- Página Anterior -->
      <li class="page-item {% if pagina_atual == 1 %}disabled{% endif %}">
        <a class="page-link custom-page-link"
           href="{{ url_for('blog_index', projeto=projeto, pagina=pagina_atual - 1) }}">
          Anterior
        </a>
      </li>

      <!-- Números de Página -->
      {% for pagina in range(1, total_paginas + 1) %}
        <li class="page-item {% if pagina == pagina_atual %}active{% endif %}">
          <a class="page-link custom-page-link"
             href="{{ url_for('blog_index', projeto=projeto, pagina=pagina) }}">
            {{ pagina }}
          </a>
        </li>
      {% endfor %}

      <!-- Página Seguinte -->
      <li class="page-item {% if pagina_atual == total_paginas %}disabled{% endif %}">
        <a class="page-link custom-page-link"
           href="{{ url_for('blog_index', projeto=projeto, pagina=pagina_atual + 1) }}">
          Próxima
        </a>
      </li>
    </ul>
  </nav>
{% endif %}

<div class="post-separator"></div>

<!-- Código Fonte -->
<h2 class="section-title mt-4" id="codigo-fonte">🔗 Código Fonte</h2>
<p>Você pode acessar o código fonte do projeto no GitHub através do botão abaixo:</p>
<div class="my-4">
  <a href="https://github.com/LuizRaizen/{{ projeto | replace(' ', '_') | lower }}"
     class="btn btn-outline-light btn-lg" target="_blank">
    <i class="fab fa-github"></i> Ver Código no GitHub
  </a>
</div>

<div class="post-separator"></div>

<!-- Ficha Técnica -->
<h2 class="section-title mt-4" id="ficha-tecnica">🔧 Ficha Técnica</h2>
<ul>
  {% if ficha_tecnica.linguagem %}
    <li><strong>Linguagem principal:</strong> {{ ficha_tecnica.linguagem }}</li>
  {% endif %}
  {% if ficha_tecnica.framework %}
    <li><strong>Framework:</strong> {{ ficha_tecnica.framework }}</li>
  {% endif %}
  {% if ficha_tecnica.paradigma %}
    <li><strong>Paradigma:</strong> {{ ficha_tecnica.paradigma }}</li>
  {% endif %}
  {% if ficha_tecnica.arquitetura %}
    <li><strong>Arquitetura:</strong> {{ ficha_tecnica.arquitetura }}</li>
  {% endif %}
  {% if ficha_tecnica.tipo_projeto %}
    <li><strong>Tipo de Projeto:</strong> {{ ficha_tecnica.tipo_projeto }}</li>
  {% endif %}
  {% if ficha_tecnica.interface %}
    <li><strong>Interface:</strong> {{ ficha_tecnica.interface }}</li>
  {% endif %}
  {% if ficha_tecnica.funcionalidades %}
    <li><strong>Funcionalidades:</strong>
      <ul>
        {% for item in ficha_tecnica.funcionalidades %}
          <li>{{ item }}</li>
        {% endfor %}
      </ul>
    </li>
  {% endif %}
  {% if ficha_tecnica.bibliotecas %}
    <li><strong>Bibliotecas Utilizadas:</strong> {{ ficha_tecnica.bibliotecas | join(', ') }}</li>
  {% endif %}
  {% if ficha_tecnica.banco_de_dados %}
    <li><strong>Banco de Dados:</strong> {{ ficha_tecnica.banco_de_dados }}</li>
  {% endif %}
  {% if ficha_tecnica.api_externa %}
    <li><strong>APIs Externas:</strong> {{ ficha_tecnica.api_externa }}</li>
  {% endif %}
  {% if ficha_tecnica.plataforma %}
    <li><strong>Plataforma Alvo:</strong> {{ ficha_tecnica.plataforma }}</li>
  {% endif %}
  {% if ficha_tecnica.resolucao %}
    <li><strong>Resolução Padrão:</strong> {{ ficha_tecnica.resolucao }}</li>
  {% endif %}
  {% if ficha_tecnica.status %}
    <li><strong>Status do Projeto:</strong> {{ ficha_tecnica.status }}</li>
  {% endif %}
</ul>

<!-- Roadmap -->
{% set status_icons = {
  "concluido": "fas fa-check-circle text-success",
  "desenvolvimento": "fas fa-spinner text-warning",
  "planejado": "far fa-circle text-secondary"
} %}

{% if roadmap %}
  {% set alerta = roadmap[0]['alerta'] if 'alerta' in roadmap[0] else None %}
  {% set metas = roadmap[1:] if alerta else roadmap %}

  {% if metas %}
    <div class="post-separator"></div>

    <h2 class="section-title mt-4" id="roadmap">📌 Roadmap do Projeto</h2>

    {% if alerta %}
      <p class="text-warning mt-3">
        <i class="fas fa-exclamation-triangle me-2"></i> {{ alerta }}
      </p>
    {% endif %}

    <ul class="list-unstyled">
      {% for item in metas %}
        <li><i class="{{ status_icons[item.status] }} me-2"></i>{{ item.meta }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <!-- Legenda -->
  <h5 class="mt-4">Legenda:</h5>
  <ul class="list-inline">
    {% for key, icon in status_icons.items() %}
      <li class="list-inline-item me-3">
        <i class="{{ icon }}"></i> {{ key.capitalize() }}
      </li>
    {% endfor %}
  </ul>
{% endif %}
{% endblock %}
